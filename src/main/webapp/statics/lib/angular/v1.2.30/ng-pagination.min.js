var directives = angular.module('activitiModeler');
directives.directive('paginationPage', function() {
	return {
		restrict : 'EA',
		replace : true,
		scope : {
			option : '=pageOption'
		},
		template : '<ul class="pagination">' +
						'<li ng-click="pageClick(p)" ng-repeat="p in page" class="{{option.curr==p?\'active\':\'\'}}">' +
							'<a href="javascript:;">{{p}}</a>' +
						'</li>' +
					'</ul>',
		link : function($rootScope) {
			$rootScope.$watch('option',function(val) {
				//容错处理
				if (!$rootScope.option.curr || isNaN($rootScope.option.curr) || $rootScope.option.curr < 1)
					$rootScope.option.curr = 1;
				if (!$rootScope.option.all || isNaN($rootScope.option.all) || $rootScope.option.all < 1)
					$rootScope.option.all = 1;
				if ($rootScope.option.curr > $rootScope.option.all)
					$rootScope.option.curr = $rootScope.option.all;
				if (!$rootScope.option.count || isNaN($rootScope.option.count) || $rootScope.option.count < 1)
					$rootScope.option.count = 10;
				//得到显示页数的数组
				$rootScope.page = getRange($rootScope.option.curr, $rootScope.option.all, $rootScope.option.count);
				//绑定点击事件
				$rootScope.pageClick = function(page) {
					if (page == '上一页') {
						page = parseInt($rootScope.option.curr) - 1;
					} else if (page == '下一页') {
						page = parseInt($rootScope.option.curr) + 1;
					}
					if (page < 1)
						page = 1;
					else if (page > $rootScope.option.all)
						page = $rootScope.option.all;
					//点击相同的页数 不执行点击事件
					if (page == $rootScope.option.curr) return;
					if ($rootScope.option.click && typeof $rootScope.option.click === 'function') {
						$rootScope.option.click(page);
						$rootScope.option.curr = page;
						$rootScope.page = getRange($rootScope.option.curr, $rootScope.option.all, $rootScope.option.count);
					}
				};

				//返回页数范围（用来遍历）
				function getRange(curr, all, count) {
					//计算显示的页数
					curr = parseInt(curr);
					all = parseInt(all);
					count = parseInt(count);
					var from = curr - parseInt(count / 2);
					var to = curr + parseInt(count / 2) + (count % 2) - 1;
					//显示的页数容处理
					if (from <= 0) {
						from = 1;
						to = from + count - 1;
						if (to > all) {
							to = all;
						}
					}
					if (to > all) {
						to = all;
						from = to - count + 1;
						if (from <= 0) {
							from = 1;
						}
					}
					var range = [];
					for (var i = from; i <= to; i++) {
						range.push(i);
					}
					range.push('下一页');
					range.unshift('上一页');
					return range;
				}
			},true)
		}
	}
});

directives.directive('checkAll', function() {
    return {
        restrict : 'EA',
    }
});